{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load custom_tags %}
{% block title %}
    Bounty Payouts - Bug Bounties & Issue Bounties
{% endblock title %}
{% block description %}
    Manage GitHub issue bounty payouts. Track bounty payments and add new issues with bounties.
{% endblock description %}
{% block keywords %}
    Bug bounties, issue bounties, GitHub issues, bounty payouts, payments, BCH transactions
{% endblock keywords %}
{% block og_title %}
    Bounty Payouts - Bug Bounties & Issue Bounties
{% endblock og_title %}
{% block og_description %}
    Manage GitHub issue bounty payouts. Track bounty payments and add new issues with bounties.
{% endblock og_description %}
{% block content %}
    {% include "includes/sidenav.html" %}
    <div class="w-full min-h-[100vh] flex flex-col items-center bg-gray-50 pb-12">
        <div class="w-[98%] lg:w-[98%] xl:w-[96%] mt-8">
            <div class="flex flex-col items-start justify-between mb-8 md:flex-row md:items-center">
                <div>
                    <h1 class="text-4xl font-bold text-gray-900 mb-2">Bounty Payouts</h1>
                    <p class="text-gray-600 text-lg">Manage and track bounty payments for GitHub issues</p>
                </div>
                <div class="mt-4 md:mt-0 space-y-2 md:space-y-0 md:space-x-4 flex flex-col md:flex-row">
                    <!-- Refresh Issues Button - Only visible to staff -->
                    {% if request.user.is_staff %}
                        <form method="post" action="">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="refresh_issues">
                            <button type="submit"
                                    class="px-4 py-2 bg-[#e74c3c] hover:bg-opacity-90 text-white rounded-md shadow-sm transition duration-300 font-medium flex items-center justify-center w-full md:w-auto">
                                <svg class="w-5 h-5 mr-2"
                                     fill="none"
                                     stroke="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                    </path>
                                </svg>
                                Fetch New GitHub Issues with $5 Bounty
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
            <!-- Filter Section -->
            <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                <div class="flex flex-col md:flex-row md:items-center gap-4">
                    <div class="flex flex-col">
                        <span class="text-lg font-semibold text-gray-800">Total Issues: {{ total_count }}</span>
                        <div class="flex flex-wrap gap-3 mt-1">
                            <span class="text-sm text-green-600 font-medium">
                                <i class="fa fa-check-circle mr-1"></i>Paid: ${{ paid_count|default:0|multiply:5 }}
                            </span>
                            <span class="text-sm text-red-600 font-medium">
                                <i class="fa fa-exclamation-circle mr-1"></i>Unpaid: ${{ unpaid_count|default:0|multiply:5 }}
                            </span>
                        </div>
                        <span class="text-sm text-gray-600 mt-1">
                            Showing closed issues
                            {% if current_payment_status != 'all' %}
                                that are
                                {% if current_payment_status == 'paid' %}
                                    <a href="https://github.com/OWASP-BLT/BLT/issues?q=is%3Aissue+state%3Aclosed+label%3A%245+label%3Apaid"
                                       target="_blank"
                                       class="text-blue-600 hover:text-[#e74c3c] hover:underline">paid</a>
                                {% else %}
                                    <a href="https://github.com/OWASP-BLT/BLT/issues?q=is%3Aissue+state%3Aclosed+label%3A%245+-label%3Apaid"
                                       target="_blank"
                                       class="text-blue-600 hover:text-[#e74c3c] hover:underline">unpaid</a>
                                {% endif %}
                            {% else %}
                                <a href="https://github.com/OWASP-BLT/BLT/issues?q=is%3Aissue+state%3Aclosed+label%3A%245"
                                   target="_blank"
                                   class="text-blue-600 hover:text-[#e74c3c] hover:underline">(view on GitHub)</a>
                            {% endif %}
                        </span>
                    </div>
                    <div class="flex flex-wrap gap-2 ml-auto">
                        <span class="text-gray-600 mr-2 self-center">Payment Status:</span>
                        <a href="?payment_status=all"
                           class="px-3 py-1.5 rounded-md text-sm font-medium transition duration-200 {% if current_payment_status == 'all' %}bg-[#e74c3c] text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                            All
                        </a>
                        <a href="?payment_status=paid"
                           class="px-3 py-1.5 rounded-md text-sm font-medium transition duration-200 {% if current_payment_status == 'paid' %}bg-[#e74c3c] text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                            Paid
                        </a>
                        <a href="?payment_status=unpaid"
                           class="px-3 py-1.5 rounded-md text-sm font-medium transition duration-200 {% if current_payment_status == 'unpaid' %}bg-[#e74c3c] text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                            Unpaid
                        </a>
                    </div>
                </div>
            </div>
            <!-- Help Info Section -->
            <div class="bg-blue-50 p-4 rounded-lg shadow-sm mb-6 border border-blue-100">
                <h3 class="text-lg font-semibold text-gray-800 mb-2 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-5 w-5 mr-2 text-blue-600"
                         fill="none"
                         viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Information About Bounty Issues
                </h3>
                <div class="text-sm text-gray-700">
                    <p class="mb-2">
                        <span class="font-medium">How issues are added:</span> Issues from GitHub with the <code class="bg-gray-100 px-1 py-0.5 rounded">$5</code> label are fetched and displayed here.
                        The refresh happens when a staff member clicks "Fetch New GitHub Issues with $5 Bounty".
                    </p>
                    <p class="mb-0">
                        <span class="font-medium">Note:</span> If you see issues locally that aren't on production,
                        it may be due to <a href="#" class="text-blue-600 hover:text-[#e74c3c] hover:underline">caching</a>,
                        <a href="#" class="text-blue-600 hover:text-[#e74c3c] hover:underline">GitHub API rate limits</a>, or
                        issues needing to be refreshed on production.
                    </p>
                </div>
            </div>
            <!-- Issues Table - Updated container with better overflow handling -->
            <div class="w-full bg-white rounded-lg shadow-sm mb-6">
                <!-- Table wrapper with proper overflow handling -->
                <div class="overflow-x-auto sm:block min-w-full max-w-full">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col"
                                    class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">
                                    Issue
                                </th>
                                <th scope="col"
                                    class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">
                                    Amount
                                </th>
                                <th scope="col"
                                    class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">
                                    Assignee
                                </th>
                                <th scope="col"
                                    class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">
                                    Payment Status
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for issue in issues %}
                                <tr class="hover:bg-gray-50">
                                    <td class="px-4 sm:px-6 py-4">
                                        <div class="flex items-start">
                                            <!-- Issue state indicator -->
                                            <span class="flex-shrink-0 w-3 h-3 mt-1.5 rounded-full {% if issue.state == 'open' %}bg-green-500{% else %}bg-red-500{% endif %}"></span>
                                            <div class="ml-3">
                                                <div class="text-sm font-medium text-gray-900 break-words flex items-center">
                                                    <a href="{{ issue.url|escape }}"
                                                       target="_blank"
                                                       class="hover:text-[#e74c3c]">{{ issue.title|escape }}</a>
                                                    {% if request.user.is_superuser %}
                                                        <form method="post"
                                                              action=""
                                                              class="ml-2 inline"
                                                              onsubmit="return confirm('Are you sure you want to delete this issue? This action cannot be undone.');">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="action" value="delete_issue">
                                                            <input type="hidden" name="issue_id" value="{{ issue.id }}">
                                                            <button type="submit"
                                                                    class="text-[#e74c3c] hover:text-opacity-70 transition-colors"
                                                                    title="Delete this issue">
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                     class="h-4 w-4"
                                                                     fill="none"
                                                                     viewBox="0 0 24 24"
                                                                     stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                                </svg>
                                                            </button>
                                                        </form>
                                                    {% endif %}
                                                    {% if request.user.is_staff %}
                                                        <a href="{% url 'admin:website_githubissue_change' issue.id %}"
                                                           target="_blank"
                                                           class="ml-2 text-blue-600 hover:text-[#e74c3c] transition-colors"
                                                           title="Edit in admin">
                                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                                 class="h-4 w-4"
                                                                 fill="none"
                                                                 viewBox="0 0 24 24"
                                                                 stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                            </svg>
                                                        </a>
                                                        <form method="post" action="" class="ml-2 inline">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="action" value="refresh_assignee">
                                                            <input type="hidden" name="issue_id" value="{{ issue.id }}">
                                                            <button type="submit"
                                                                    class="text-blue-600 hover:text-[#e74c3c] transition-colors"
                                                                    title="Refresh assignee from GitHub">
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                     class="h-4 w-4"
                                                                     fill="none"
                                                                     viewBox="0 0 24 24"
                                                                     stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                                </svg>
                                                            </button>
                                                        </form>
                                                        <!-- Pull request refresh button -->
                                                        <form method="post" action="" class="ml-2 inline">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="action" value="refresh_pull_requests">
                                                            <input type="hidden" name="issue_id" value="{{ issue.id }}">
                                                            <button type="submit"
                                                                    class="text-blue-600 hover:text-[#e74c3c] transition-colors"
                                                                    title="Refresh linked pull requests from GitHub">
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                     class="h-4 w-4"
                                                                     fill="none"
                                                                     viewBox="0 0 24 24"
                                                                     stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                                                </svg>
                                                            </button>
                                                        </form>
                                                    {% endif %}
                                                </div>
                                                <div class="text-xs text-gray-500">{{ issue.repo.name }} • {{ issue.created_at|date:"M d, Y" }}</div>
                                                <!-- Linked Pull Requests Section -->
                                                {% if issue.linked_pull_requests.all %}
                                                    <div class="mt-2 text-xs">
                                                        <div class="text-gray-700 font-medium mb-1">
                                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                                 class="h-3.5 w-3.5 inline-block -mt-0.5 text-[#e74c3c]"
                                                                 fill="none"
                                                                 viewBox="0 0 24 24"
                                                                 stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                                            </svg>
                                                            Linked PRs:
                                                        </div>
                                                        <ul class="pl-5 space-y-1">
                                                            {% for pr in issue.linked_pull_requests.all %}
                                                                <li class="flex items-center">
                                                                    <svg xmlns="http://www.w3.org/2000/svg"
                                                                         class="h-3 w-3 mr-1 text-purple-600"
                                                                         fill="none"
                                                                         viewBox="0 0 24 24"
                                                                         stroke="currentColor">
                                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                                                                    </svg>
                                                                    <a href="{{ pr.url }}"
                                                                       target="_blank"
                                                                       class="text-blue-600 hover:text-[#e74c3c] truncate">
                                                                        #{{ pr.issue_id }}: {{ pr.title|truncatechars:40 }}
                                                                        <span class="text-gray-500 font-normal">
                                                                            by
                                                                            {% if pr.contributor %}
                                                                                {{ pr.contributor.name }}
                                                                            {% elif pr.user_profile %}
                                                                                {{ pr.user_profile.user.username }}
                                                                            {% else %}
                                                                                Unknown
                                                                            {% endif %}
                                                                        </span>
                                                                    </a>
                                                                    {% if pr.is_merged %}
                                                                        <span class="ml-1 px-1.5 py-0.5 bg-purple-100 text-purple-800 rounded text-[10px] font-medium">Merged</span>
                                                                    {% elif pr.state == 'closed' %}
                                                                        <span class="ml-1 px-1.5 py-0.5 bg-red-100 text-red-800 rounded text-[10px] font-medium">Closed</span>
                                                                    {% else %}
                                                                        <span class="ml-1 px-1.5 py-0.5 bg-green-100 text-green-800 rounded text-[10px] font-medium">Open</span>
                                                                    {% endif %}
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    </div>
                                                {% elif issue.type == 'issue' and request.user.is_staff %}
                                                    <div class="mt-2 text-xs">
                                                        <div class="text-gray-500 italic flex items-center">
                                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                                 class="h-3.5 w-3.5 mr-1 text-gray-400"
                                                                 fill="none"
                                                                 viewBox="0 0 24 24"
                                                                 stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                            </svg>
                                                            No linked pull requests found. Click the
                                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                                 class="inline-block h-3.5 w-3.5 text-[#e74c3c]"
                                                                 fill="none"
                                                                 viewBox="0 0 24 24"
                                                                 stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                                            </svg>
                                                            button to fetch linked PRs from GitHub.
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                <!-- Tags/Labels -->
                                                <div class="mt-1 flex flex-wrap gap-1">
                                                    <!-- Removed unnecessary tags: closed, issue, $5 -->
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-4 sm:px-6 py-4 whitespace-nowrap">
                                        <div class="text-xl font-bold text-green-600">$5</div>
                                    </td>
                                    <td class="px-4 sm:px-6 py-4">
                                        <div class="flex items-center">
                                            {% if issue.assignee %}
                                                <div class="mr-3">
                                                    <img src="{{ issue.assignee.avatar_url }}"
                                                         alt="{{ issue.assignee.name }}"
                                                         class="rounded-full"
                                                         width="40"
                                                         height="40">
                                                </div>
                                                <div>
                                                    <a href="{{ issue.assignee.github_url }}"
                                                       target="_blank"
                                                       class="font-medium text-blue-600 hover:underline">
                                                        {{ issue.assignee.name }}
                                                    </a>
                                                    {% if issue.user_profile and issue.user_profile.bch_address %}
                                                        <div class="text-xs text-gray-600 mt-1">
                                                            <i class="fa fa-bitcoin" aria-hidden="true"></i>
                                                            <span class="bch-address"
                                                                  title="{{ issue.user_profile.bch_address|escape }}">{{ issue.user_profile.bch_address|slice:":15"|escape }}...</span>
                                                            <button class="copy-btn text-blue-500 hover:text-blue-700 ml-1"
                                                                    onclick="copyBchAddress('{{ issue.user_profile.bch_address|escapejs }}')">
                                                                <i class="fa fa-copy"></i>
                                                            </button>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            {% else %}
                                                <span class="text-gray-500">No assignee</span>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="px-4 sm:px-6 py-4">
                                        {% if issue.sponsors_tx_id or issue.bch_tx_id %}
                                            <div class="text-sm font-medium text-green-600">
                                                {% if issue.sponsors_tx_id %}
                                                    Paid with Sponsors
                                                    <div class="text-xs text-gray-500 font-mono break-all mt-1">TX: {{ issue.sponsors_tx_id|escape }}</div>
                                                {% elif issue.bch_tx_id %}
                                                    Paid with BCH
                                                    <div class="text-xs text-gray-500 font-mono break-all mt-1">
                                                        TX: <a href="https://blockchair.com/bitcoin-cash/transaction/{{ issue.bch_tx_id|escape }}"
    target="_blank"
    class="text-blue-600 hover:text-blue-800 hover:underline">{{ issue.bch_tx_id|escape }}</a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                            <div class="text-xs text-gray-500 mt-1">
                                                {% if issue.p2p_payment_created_at %}Paid on {{ issue.p2p_payment_created_at|date:"M d, Y" }}{% endif %}
                                                {% if issue.sent_by_user %}by {{ issue.sent_by_user.username|escape }}{% endif %}
                                            </div>
                                        {% else %}
                                            <div class="text-sm font-medium text-red-600 mb-2">Unpaid</div>
                                            {% if request.user.is_superuser %}
                                                <form method="post" action="" class="mt-1 flex flex-col gap-1">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="action" value="pay_bounty">
                                                    <input type="hidden" name="issue_id" value="{{ issue.id }}">
                                                    <div class="relative flex items-center">
                                                        <input type="text"
                                                               name="tx_id"
                                                               class="w-full py-1.5 px-2 text-xs border border-gray-300 rounded-md focus:ring-[#e74c3c] focus:border-[#e74c3c] font-mono"
                                                               placeholder="Enter transaction ID"
                                                               required
                                                               pattern="(ch_[a-zA-Z0-9]+|\b[a-fA-F0-9]{64}\b)"
                                                               title="Enter a valid transaction ID (GitHub Sponsors ID or BCH hash)">
                                                        <input type="hidden"
                                                               name="payment_method"
                                                               id="payment_method_{{ issue.id }}"
                                                               value="">
                                                        <button type="submit"
                                                                class="ml-1 p-1.5 bg-[#e74c3c] text-white rounded hover:bg-opacity-90">
                                                            <svg class="w-4 h-4"
                                                                 fill="none"
                                                                 stroke="currentColor"
                                                                 viewBox="0 0 24 24"
                                                                 xmlns="http://www.w3.org/2000/svg">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                    <div class="flex items-center justify-between">
                                                        <span class="text-xs text-gray-500 mt-1" id="tx_type_{{ issue.id }}">Enter ch_* for Sponsors or BCH hash</span>
                                                        <a id="explorer_link_{{ issue.id }}"
                                                           href="#"
                                                           target="_blank"
                                                           class="text-xs text-blue-600 hover:text-blue-800 ml-2 hidden">
                                                            View in Explorer
                                                        </a>
                                                    </div>
                                                </form>
                                                <script>
                                                    document.querySelectorAll('input[name="tx_id"]').forEach(input => {
                                                        input.addEventListener('input', function() {
                                                            const txId = this.value.trim();
                                                            const issueId = this.closest('form').querySelector('input[name="issue_id"]').value;
                                                            const paymentMethodInput = document.getElementById(`payment_method_${issueId}`);
                                                            const txTypeElement = document.getElementById(`tx_type_${issueId}`);
                                                            const explorerLink = document.getElementById(`explorer_link_${issueId}`);
                                                            
                                                            if (txId.startsWith('ch_')) {
                                                                paymentMethodInput.value = 'sponsors';
                                                                txTypeElement.textContent = "GitHub Sponsors transaction detected";
                                                                txTypeElement.classList.add('text-green-600');
                                                                txTypeElement.classList.remove('text-gray-500', 'text-red-500');
                                                                explorerLink.classList.add('hidden');
                                                            } else if (/^[a-fA-F0-9]{64}$/.test(txId)) {
                                                                paymentMethodInput.value = 'bch';
                                                                txTypeElement.textContent = "Valid BCH transaction hash detected";
                                                                txTypeElement.classList.add('text-green-600');
                                                                txTypeElement.classList.remove('text-gray-500', 'text-red-500');
                                                                explorerLink.href = `https://blockchair.com/bitcoin-cash/transaction/${txId}`;
                                                                explorerLink.classList.remove('hidden');
                                                            } else {
                                                                paymentMethodInput.value = '';
                                                                if (txId.length > 0) {
                                                                    txTypeElement.textContent = "Invalid transaction ID format";
                                                                    txTypeElement.classList.add('text-red-500');
                                                                    txTypeElement.classList.remove('text-gray-500', 'text-green-600');
                                                                } else {
                                                                    txTypeElement.textContent = "Enter ch_* for Sponsors or BCH hash";
                                                                    txTypeElement.classList.add('text-gray-500');
                                                                    txTypeElement.classList.remove('text-red-500', 'text-green-600');
                                                                }
                                                                explorerLink.classList.add('hidden');
                                                            }
                                                        });
                                                    });
                                                </script>
                                            {% else %}
                                                {% if request.user.is_staff %}
                                                    <div class="text-xs text-gray-500 mt-1">
                                                        <i class="fa fa-lock mr-1"></i> Only superusers can record payments
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="4" class="px-4 sm:px-6 py-10 text-center text-gray-500">
                                        <div class="flex flex-col items-center">
                                            <svg class="w-12 h-12 text-gray-400 mb-4"
                                                 fill="none"
                                                 stroke="currentColor"
                                                 viewBox="0 0 24 24"
                                                 xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                                </path>
                                            </svg>
                                            <p class="text-gray-600 font-medium">No bounty issues found</p>
                                            <p class="text-gray-500 text-sm mt-1">Try changing your filters or click "Fetch New GitHub Issues with $5 Bounty"</p>
                                            <div class="mt-3 text-sm text-gray-600">
                                                <p class="mb-1">
                                                    Recent issues like <a href="https://github.com/OWASP-BLT/BLT/issues/2912"
    target="_blank"
    class="text-blue-600 hover:text-[#e74c3c] hover:underline">#2912</a> may not appear yet.
                                                </p>
                                                <p>They need to be refreshed from GitHub manually by a staff member.</p>
                                            </div>
                                            {% if request.user.is_staff %}
                                                <div class="mt-4">
                                                    <form method="post" action="">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="action" value="refresh_issues">
                                                        <button type="submit"
                                                                class="px-4 py-2 bg-[#e74c3c] hover:bg-opacity-90 text-white rounded-md shadow-sm transition duration-300 font-medium flex items-center justify-center">
                                                            <svg class="w-5 h-5 mr-2"
                                                                 fill="none"
                                                                 stroke="currentColor"
                                                                 viewBox="0 0 24 24"
                                                                 xmlns="http://www.w3.org/2000/svg">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                                                </path>
                                                            </svg>
                                                            Refresh Issues from GitHub Now
                                                        </button>
                                                    </form>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Pagination -->
            {% if is_paginated %}
                <div class="w-full bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 rounded-lg shadow-sm">
                    <div class="flex-1 flex flex-col sm:flex-row sm:items-center sm:justify-between">
                        <div class="mb-4 sm:mb-0">
                            <p class="text-sm text-gray-700">
                                Showing
                                <span class="font-medium">{{ page_obj.start_index }}</span>
                                to
                                <span class="font-medium">{{ page_obj.end_index }}</span>
                                of
                                <span class="font-medium">{{ paginator.count }}</span>
                                results
                            </p>
                        </div>
                        <div class="flex justify-center">
                            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"
                                 aria-label="Pagination">
                                {% if page_obj.has_previous %}
                                    <a href="?page=1&payment_status={{ current_payment_status }}"
                                       class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <span class="sr-only">First</span>
                                        <svg class="h-5 w-5"
                                             xmlns="http://www.w3.org/2000/svg"
                                             viewBox="0 0 20 20"
                                             fill="currentColor"
                                             aria-hidden="true">
                                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                                        </svg>
                                    </a>
                                    <a href="?page={{ page_obj.previous_page_number }}&payment_status={{ current_payment_status }}"
                                       class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <span class="sr-only">Previous</span>
                                        <svg class="h-5 w-5"
                                             xmlns="http://www.w3.org/2000/svg"
                                             viewBox="0 0 20 20"
                                             fill="currentColor"
                                             aria-hidden="true">
                                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                                        </svg>
                                    </a>
                                {% endif %}
                                {% for num in paginator.page_range %}
                                    {% if page_obj.number == num %}
                                        <a href="?page={{ num }}&payment_status={{ current_payment_status }}"
                                           class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-[#e74c3c] text-sm font-medium text-white">
                                            {{ num }}
                                        </a>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                        <a href="?page={{ num }}&payment_status={{ current_payment_status }}"
                                           class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                                            {{ num }}
                                        </a>
                                    {% endif %}
                                {% endfor %}
                                {% if page_obj.has_next %}
                                    <a href="?page={{ page_obj.next_page_number }}&payment_status={{ current_payment_status }}"
                                       class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <span class="sr-only">Next</span>
                                        <svg class="h-5 w-5"
                                             xmlns="http://www.w3.org/2000/svg"
                                             viewBox="0 0 20 20"
                                             fill="currentColor"
                                             aria-hidden="true">
                                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                                        </svg>
                                    </a>
                                    <a href="?page={{ paginator.num_pages }}&payment_status={{ current_payment_status }}"
                                       class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <span class="sr-only">Last</span>
                                        <svg class="h-5 w-5"
                                             xmlns="http://www.w3.org/2000/svg"
                                             viewBox="0 0 20 20"
                                             fill="currentColor"
                                             aria-hidden="true">
                                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                                        </svg>
                                    </a>
                                {% endif %}
                            </nav>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock content %}
{% block scripts %}
    <script>
    function copyBchAddress(address) {
        navigator.clipboard.writeText(address).then(() => {
            const copyBtn = event.currentTarget;
            const icon = copyBtn.querySelector('i');
            
            // Store original classes
            const originalClass = icon.className;
            
            // Change to check icon and green color
            icon.className = 'fa fa-check';
            copyBtn.classList.add('text-green-600');
            copyBtn.classList.remove('text-blue-500', 'hover:text-blue-700');
            
            // Reset after 2 seconds
            setTimeout(() => {
                icon.className = originalClass;
                copyBtn.classList.remove('text-green-600');
                copyBtn.classList.add('text-blue-500', 'hover:text-blue-700');
            }, 2000);
        });
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        // Copy BCH Address functionality
        document.querySelectorAll('.copy-address').forEach(button => {
            button.addEventListener('click', function() {
                const address = this.dataset.address;
                navigator.clipboard.writeText(address).then(() => {
                    const originalText = this.textContent;
                    this.textContent = 'Copied!';
                    this.classList.add('text-green-600');
                    
                    setTimeout(() => {
                        this.textContent = originalText;
                        this.classList.remove('text-green-600');
                    }, 2000);
                });
            });
        });
    });
    </script>
{% endblock scripts %}
