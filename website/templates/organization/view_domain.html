{% extends "base.html" %}
{% block head %}
    Domain Info
{% endblock head %}
{% block description %}
    View domain details, including domain name, URL, organization information, and social media links. Keep track of all your domains easily.
{% endblock description %}
{% block keywords %}
    view domain, domain details, domain information, domain URL, organization information, social media links
{% endblock keywords %}
{% block content %}
    {% include "includes/sidenav.html" %}
    <div>
        <div class="fixed bottom-2.5 right-3.75">
            <a href="https://github.com/OWASP-BLT/BLT/blob/main/website/templates/organization/view_domains.html">
                <i class="fab fa-github"></i>
            </a>
            <a href="https://www.figma.com/file/s0xuxeU6O2guoWEfA9OElZ/Design?node-id=3%3A76&t=pqxWpF3hcYxjEDrs-1">
                <i class="fab fa-figma"></i>
            </a>
        </div>
        <div class="h-full bg-gray-200 p-8">
            <div class="bg-white rounded-lg shadow-xl pb-8">
                <div class="w-full h-[250px]">
                    <img src="{% if webshot %} {{ MEDIA_URL }}{{ webshot }} {% else %} https://versohydraulic.com/bitrix/templates/aspro-allcorp/images/background.png {% endif %} "
                         class="w-full h-full rounded-tl-lg rounded-tr-lg object-cover"
                         alt="domain image"
                         width="100%"
                         height="100%">
                </div>
                <div class="flex flex-col items-center -mt-20">
                    <img src="{% if logo %} {{ MEDIA_URL }}{{ logo }} {% else %} https://via.placeholder.com/160?text=No+Logo {% endif %}"
                         class="w-40 h-40 border-4  rounded-full"
                         width="160px"
                         height="160px"
                         alt="domain logo">
                    <div class="flex items-center space-x-2 mt-2">
                        <p class="text-2xl">{{ name }}</p>
                        <a href="{{ url }}" class="m-0 p-0">
                            <i class="fa-sharp fa-solid fa-arrow-up-right-from-square fa-lg text-[#596780] hover:text-black"></i>
                        </a>
                    </div>
                </div>
                <div class="flex-1 flex flex-col items-center lg:items-end justify-end px-8 mt-2">
                    <div class="flex items-center space-x-4 mt-2">
                        <a href="#"
                           onclick="history.back(); return false;"
                           class="flex items-center bg-red-600 hover:bg-red-700 text-gray-100 px-4 py-2 rounded text-sm space-x-2 transition duration-100">
                            <i class="fa-sharp fa-solid fa-cog fa-lg text-white"></i>
                            <span>Back</span>
                        </a>
                        <a href="{% url 'report' %}"
                           class="flex items-center bg-red-600 hover:bg-red-700 text-gray-100 px-4 py-2 rounded text-sm space-x-2 transition duration-100">
                            <i class="fa-sharp fa-solid fa-bug fa-lg text-white"></i>
                            <span>Submit Bug</span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="my-4 flex flex-col 2xl:flex-row space-y-4 2xl:space-y-0 2xl:space-x-4">
                <div class="w-full flex flex-col 2xl:w-1/3">
                    <div class="flex-1 bg-white rounded-lg shadow-xl p-8">
                        <h4 class="text-xl text-gray-900 font-bold">Domain Info</h4>
                        <ul class="mt-2 text-gray-700">
                            <li class="flex border-y py-2 my-2">
                                <span class="font-bold w-24">Domain:</span>
                                <span class="text-gray-700">{{ name }}</span>
                            </li>
                            <li class="flex border-b py-2 my-2">
                                <span class="font-bold w-24">Url</span>
                                <span class="text-gray-700">{{ url }}</span>
                            </li>
                            <li class="flex border-b py-2 my-2">
                                <span class="font-bold w-24">Organization</span>
                                <span class="text-gray-700">{{ organization.name }}</span>
                            </li>
                            <li class="flex border-b py-2 my-2">
                                <span class="font-bold w-24">Email:</span>
                                <span class="text-gray-700">{{ email }}</span>
                            </li>
                            <li class="flex border-b py-2 my-2">
                                <span class="font-bold w-24">Joined:</span>
                                <span class="text-gray-700">{{ created|date:"d/m/Y" }}</span>
                            </li>
                            <li class="flex items-center border-b py-2 space-x-2 my-2">
                                <span class="font-bold w-24">Socials:</span>
                                <a href="{% if facebook %} {{ facebook }} {% else %} # {% endif %}"
                                   target="{% if facebook %} _blank {% endif %}"
                                   title="Facebook"
                                   rel="noopener noreferrer">
                                    <svg class="w-5 h-5"
                                         id="Layer_1"
                                         data-name="Layer 1"
                                         xmlns="http://www.w3.org/2000/svg"
                                         viewBox="0 0 506.86 506.86">
                                        <path class="fill-[#1877f2]" d="M506.86,253.43C506.86,113.46,393.39,0,253.43,0S0,113.46,0,253.43C0,379.92,92.68,484.77,213.83,503.78V326.69H149.48V253.43h64.35V197.6c0-63.52,37.84-98.6,95.72-98.6,27.73,0,56.73,5,56.73,5v62.36H334.33c-31.49,0-41.3,19.54-41.3,39.58v47.54h70.28l-11.23,73.26H293V503.78C414.18,484.77,506.86,379.92,506.86,253.43Z">
                                        </path>
                                        <path class="fill-white" d="M352.08,326.69l11.23-73.26H293V205.89c0-20,9.81-39.58,41.3-39.58h31.95V104s-29-5-56.73-5c-57.88,0-95.72,35.08-95.72,98.6v55.83H149.48v73.26h64.35V503.78a256.11,256.11,0,0,0,79.2,0V326.69Z">
                                        </path>
                                    </svg>
                                </a>
                                <a href="{% if twitter %} {{ twitter }} {% else %} # {% endif %}"
                                   target="{% if twitter %} _blank {% endif %}"
                                   title="Twitter"
                                   rel="noopener noreferrer">
                                    <svg class="w-5 h-5"
                                         xmlns="http://www.w3.org/2000/svg"
                                         viewBox="0 0 333333 333333"
                                         shape-rendering="geometricPrecision"
                                         text-rendering="geometricPrecision"
                                         image-rendering="optimizeQuality"
                                         fill-rule="evenodd"
                                         clip-rule="evenodd">
                                        <path d="M166667 0c92048 0 166667 74619 166667 166667s-74619 166667-166667 166667S0 258715 0 166667 74619 0 166667 0zm90493 110539c-6654 2976-13822 4953-21307 5835 7669-4593 13533-11870 16333-20535-7168 4239-15133 7348-23574 9011-6787-7211-16426-11694-27105-11694-20504 0-37104 16610-37104 37101 0 2893 320 5722 949 8450-30852-1564-58204-16333-76513-38806-3285 5666-5022 12109-5022 18661v4c0 12866 6532 24246 16500 30882-6083-180-11804-1876-16828-4626v464c0 17993 12789 33007 29783 36400-3113 845-6400 1313-9786 1313-2398 0-4709-247-7007-665 4746 14736 18448 25478 34673 25791-12722 9967-28700 15902-46120 15902-3006 0-5935-184-8860-534 16466 10565 35972 16684 56928 16684 68271 0 105636-56577 105636-105632 0-1630-36-3209-104-4806 7251-5187 13538-11733 18514-19185l17-17-3 2z" fill="#1da1f2">
                                        </path>
                                    </svg>
                                </a>
                                <a href="{% if github %} {{ github }} {% else %} # {% endif %}"
                                   target="{% if github %} _blank {% endif %}"
                                   title="Github"
                                   rel="noopener noreferrer">
                                    <svg class="w-5 h-5"
                                         xmlns="http://www.w3.org/2000/svg"
                                         width="0"
                                         height="0"
                                         shape-rendering="geometricPrecision"
                                         text-rendering="geometricPrecision"
                                         image-rendering="optimizeQuality"
                                         fill-rule="evenodd"
                                         clip-rule="evenodd"
                                         viewBox="0 0 640 640">
                                        <path d="M319.988 7.973C143.293 7.973 0 151.242 0 327.96c0 141.392 91.678 261.298 218.826 303.63 16.004 2.964 21.886-6.957 21.886-15.414 0-7.63-.319-32.835-.449-59.552-89.032 19.359-107.8-37.772-107.8-37.772-14.552-36.993-35.529-46.831-35.529-46.831-29.032-19.879 2.209-19.442 2.209-19.442 32.126 2.245 49.04 32.954 49.04 32.954 28.56 48.922 74.883 34.76 93.131 26.598 2.882-20.681 11.15-34.807 20.315-42.803-71.08-8.067-145.797-35.516-145.797-158.14 0-34.926 12.52-63.485 32.965-85.88-3.33-8.078-14.291-40.606 3.083-84.674 0 0 26.87-8.61 88.029 32.8 25.512-7.075 52.878-10.642 80.056-10.76 27.2.118 54.614 3.673 80.162 10.76 61.076-41.386 87.922-32.8 87.922-32.8 17.398 44.08 6.485 76.631 3.154 84.675 20.516 22.394 32.93 50.953 32.93 85.879 0 122.907-74.883 149.93-146.117 157.856 11.481 9.921 21.733 29.398 21.733 59.233 0 42.792-.366 77.28-.366 87.804 0 8.516 5.764 18.473 21.992 15.354 127.076-42.354 218.637-162.274 218.637-303.582 0-176.695-143.269-319.988-320-319.988l-.023.107z">
                                        </path>
                                    </svg>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="flex-1 bg-white rounded-lg shadow-xl mt-4 p-8">
                        <h4 class="text-xl text-gray-900 font-bold">Activity log</h4>
                        <div class="relative px-4">
                            <div class="absolute h-full border border-dashed border-opacity-20 border-secondary"></div>
                            <!-- Domain Created At -->
                            <div class="flex items-center w-full my-6 -ml-1.5">
                                <div class="w-1/12 z-10">
                                    <div class="w-3.5 h-3.5 bg-red-600 rounded-full"></div>
                                </div>
                                <div class="w-11/12">
                                    <p class="text-sm">Domain created at: {{ created|date:"d/m/Y" }}</p>
                                    <p class="text-xs text-gray-500">{{ created|timesince }} ago</p>
                                </div>
                            </div>
                            <!-- Last Modification in Domain -->
                            <div class="flex items-center w-full my-6 -ml-1.5">
                                <div class="w-1/12 z-10">
                                    <div class="w-3.5 h-3.5 bg-red-600 rounded-full"></div>
                                </div>
                                <div class="w-11/12">
                                    <p class="text-sm">Last modification in domain: {{ modified|date:"d/m/Y" }}</p>
                                    <p class="text-xs text-gray-500">{{ modified|timesince }} ago</p>
                                </div>
                            </div>
                            {% if first_bug %}
                                <!-- First Bug in the Domain -->
                                <div class="flex items-center w-full my-6 -ml-1.5">
                                    <div class="w-1/12 z-10">
                                        <div class="w-3.5 h-3.5 bg-red-600 rounded-full"></div>
                                    </div>
                                    <div class="w-11/12">
                                        <p class="text-sm">First bug in this domain: {{ first_bug.created|date:"d/m/Y" }}</p>
                                        <p class="text-xs text-gray-500">{{ first_bug.created|timesince }} ago</p>
                                    </div>
                                </div>
                            {% endif %}
                            {% if last_bug %}
                                <!-- Last Bug Created in the Domain -->
                                <div class="flex items-center w-full my-6 -ml-1.5">
                                    <div class="w-1/12 z-10">
                                        <div class="w-3.5 h-3.5 bg-red-600 rounded-full"></div>
                                    </div>
                                    <div class="w-11/12">
                                        <p class="text-sm">Last bug created in this domain: {{ last_bug.created|date:"d/m/Y" }}</p>
                                        <p class="text-xs text-gray-500">{{ last_bug.created|timesince }} ago</p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="flex flex-col w-full 2xl:w-2/3">
                    <div class="flex-1 bg-white rounded-lg shadow-xl p-8">
                        <h4 class="text-xl text-gray-900 font-bold">Statistics</h4>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-4">
                            <div class="px-6 py-6 bg-gray-100 border border-gray-300 rounded-lg shadow-xl">
                                <div class="flex items-center justify-between">
                                    <span class="font-bold text-sm text-indigo-600">Total Rewarded</span>
                                </div>
                                <div class="flex items-center justify-between mt-6">
                                    <div>
                                        <svg class="w-12 h-12 p-2.5 bg-indigo-400 bg-opacity-20 rounded-full text-indigo-600 border border-indigo-600"
                                             fill="none"
                                             stroke="currentColor"
                                             viewBox="0 0 24 24"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                            </path>
                                        </svg>
                                    </div>
                                    <div class="flex flex-col">
                                        <div class="flex items-end">
                                            <span class="text-2xl 2xl:text-3xl font-bold">${{ total_money_distributed }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="px-6 py-6 bg-gray-100 border border-gray-300 rounded-lg shadow-xl">
                                <div class="flex items-center justify-between">
                                    <span class="font-bold text-sm text-green-600">Total Bugs</span>
                                </div>
                                <div class="flex items-center justify-between mt-6">
                                    <div>
                                        <svg class="w-12 h-12 p-2.5 bg-green-400 bg-opacity-20 rounded-full text-green-600 border border-green-600"
                                             fill="none"
                                             stroke="currentColor"
                                             viewBox="0 0 24 24"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
                                            </path>
                                        </svg>
                                    </div>
                                    <div class="flex flex-col">
                                        <div class="flex items-end">
                                            <span class="text-2xl 2xl:text-3xl font-bold">{{ total_bug_reported }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="px-6 py-6 bg-gray-100 border border-gray-300 rounded-lg shadow-xl">
                                <div class="flex items-center justify-between">
                                    <span class="font-bold text-sm text-red-600">Accepted Bugs</span>
                                </div>
                                <div class="flex items-center justify-between mt-6">
                                    <div>
                                        <svg class="w-12 h-12 p-2.5 bg-red-400 bg-opacity-20 rounded-full text-red-600 border border-red-600"
                                             fill="none"
                                             stroke="currentColor"
                                             viewBox="0 0 24 24"
                                             xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
                                            </path>
                                        </svg>
                                    </div>
                                    <div class="flex flex-col">
                                        <div class="flex items-end">
                                            <span class="text-2xl 2xl:text-3xl font-bold">{{ total_bug_accepted }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <canvas id="verticalBarChart"
                                    width="1656"
                                    height="828"
                                    class="block h-[414px] w-[828px] box-border"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white w-full p-10 my-5">
                <div class="w-full flex justify-between">
                    <h4 class="text-xl text-gray-900 font-bold mb-5">Ongoing Bughunts</h4>
                    <a href="{% url 'hunts' %}" class="text-md text-blue-600">View all</a>
                </div>
                <div class="flex justify-between w-full flex-wrap">
                    {% if ongoing_bughunts %}
                        {% for hunt in ongoing_bughunts %}
                            <div class="flex w-full md:w-[48%] lg:w-[30%] h-[180px] border-2 border-gray-300 p-2 cursor-pointer shadow-sm hover:scale-105 hover:shadow-lg transition-all m-2 sm:mt-5 rounded-lg">
                                <div class="flex justify-center items-center w-[40%]">
                                    <img class="w-32 h-32 rounded-lg" {{ hunt.logo }} src="{% if hunt.logo %} {{ MEDIA_URL }}{{ hunt.logo }} {% else %} https://via.placeholder.com/128?text=No+Logo {% endif %}" alt="bughunt logo" width="128px" height="128px">
                                </div>
                                <div class="flex flex-col ml-5 w-[60%]">
                                    <p class="text-lg font-extrabold mt-6">{{ hunt.name }}</p>
                                    <p class="tw-font-extralight text-gray-500 text-sm mt-1">{{ hunt.url }}</p>
                                    <div class="flex mt-5 justify-between items-center w-full">
                                        <p class="font-bold">
                                            $
                                            {% if hunt.total_prize %}
                                                {{ hunt.total_prize }}
                                            {% else %}
                                                0
                                            {% endif %}
                                        </p>
                                        <a href="{% url 'show_bughunt' hunt.id %}"
                                           class="bg-red-600 text-white px-3 py-1 font-bold rounded-md">More info</a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="w-full h-full flex items-center justify-center">
                            <p class="text-xl text-red-500">No ongoing bughunts available</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="w-full flex justify-between min-h-[80vh] flex-col md:flex-row">
                <div class="flex flex-col w-full md:w-[80%] mr-5 items-start bg-white rounded-xl p-5 overflow-x-hidden overflow-y-scroll">
                    <div class="w-full flex justify-between">
                        <h4 class="text-xl text-gray-900 font-bold mb-5">Latest Bugs Reported ({{ latest_issues|length }})</h4>
                        <a href="{% url 'issues' %}" class="text-md text-blue-600">View all</a>
                    </div>
                    {% if latest_issues|length > 0 %}
                        {% for issue in latest_issues %}
                            <div class="w-full h-[200px] flex px-5 my-2 py-6 bg-white rounded-lg shadow-md hover:shadow-xl transition-all">
                                <div class="w-[10%] mr-5 h-full flex items-center">
                                    <img src="{% if issue.first_screenshot %} {{ MEDIA_URL }}{{ issue.first_screenshot }} {% else %} https://via.placeholder.com/100?text=No+Screenshot {% endif %}"
                                         alt="bug"
                                         width="100%"
                                         height="100%">
                                </div>
                                <div class="w-full h-full">
                                    <div class="flex justify-between items-center">
                                        <span class="font-light text-gray-600">Reported to {{ issue.domain__name }} on {{ issue.created|date:"d/m/Y" }}</span>
                                        <div>
                                            <a class="px-2 py-1 mx-2 bg-red-600 text-white font-bold rounded hover:bg-red-500">#{{ issue.label }}</a>
                                            <a class="px-2 py-1 mx-2 bg-red-600 text-white font-bold rounded hover:bg-red-500">#{{ issue.status }}</a>
                                            {% if issue.verified %}
                                                <a class="px-2 py-1 mx-2 bg-red-600 text-white font-bold rounded hover:bg-red-500">#Accepted</a>
                                                <a class="px-2 py-1 mx-2 bg-red-600 text-white font-bold rounded hover:bg-red-500">#{{ issue.rewarded }}</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <a class="text-xl text-black font-bold hover:text-gray-700"
                                           href="{% url 'issue_view' issue.id %}">{{ issue.description }}</a>
                                    </div>
                                    <div class="flex justify-between items-center mt-4">
                                        <div>
                                            <a class="flex items-center"
                                               href="{% url 'profile' issue.user__username %}">
                                                <img class="mr-3 w-10 h-10 object-cover rounded-full hidden sm:block"
                                                     src="{% if issue.user__userprofile__user_avatar %} {{ MEDIA_URL }}{{ issue.user__userprofile__user_avatar }} {% else %} https://via.placeholder.com/40?text=No+Avatar {% endif %}"
                                                     alt="avatar"
                                                     width="40px"
                                                     height="40px">
                                                <h1 class="text-gray-700 font-bold">{{ issue.user__username }}</h1>
                                            </a>
                                        </div>
                                        <a class="text-blue-600 hover:underline"
                                           href="{% url 'issue_view' issue.id %}">Read more</a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="w-full h-full flex items-center justify-center">
                            <p class="text-xl text-red-500">No bugs reported</p>
                        </div>
                    {% endif %}
                </div>
                <div class="bg-white rounded-lg shadow-xl p-8 w-full mt-5 md:w-[20%] md:mt-0 overflow-y-scroll">
                    <div class="flex items-center justify-between">
                        <h4 class="text-xl text-gray-900 font-bold">Top Testers ({{ top_testers | length }})</h4>
                    </div>
                    <div class="flex flex-wrap justify-between mt-10">
                        {% for tester in top_testers %}
                            <a href="{% url 'profile' tester.user__username %}"
                               class="flex flex-col items-center m-5 justify-center text-gray-800 hover:text-red-600"
                               title="View Profile">
                                <img src="{% if tester.user__userprofile__user_avatar %} {{ MEDIA_URL }}{{ tester.user__userprofile__user_avatar }} {% else %} https://via.placeholder.com/100?text=No+Avatar {% endif %}"
                                     class="w-[100px] rounded-full"
                                     alt="tester avatar"
                                     width="100px"
                                     height="100px">
                                <p class="text-center font-bold text-sm mt-1">{{ tester.user__username }}</p>
                                <p class="text-xs text-gray-500 text-center">Reported {{ tester.count }} Bugs</p>
                            </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
{% block scripts %}
    <script>
            document.addEventListener('DOMContentLoaded', function() {
            const DATA_SET_VERTICAL_BAR_CHART_1 = JSON.parse('{{ monthly_activity_chart|escapejs | safe }}');

            const labels_vertical_bar_chart = ['January', 'February', 'Mart', 'April', 'May', 'Jun', 'July', 'August', 'September', 'October', 'November', 'December'];

            const dataVerticalBarChart= {
                labels: labels_vertical_bar_chart,
                datasets: [
                    {
                        label: 'Bugs Reported',
                        data: DATA_SET_VERTICAL_BAR_CHART_1,
                        borderColor: 'rgb(54, 162, 235)',
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    }
                ]
            };
            const configVerticalBarChart = {
                type: 'bar',
                data: dataVerticalBarChart,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Monthly Activity'
                        }
                    }
                },
            };

            var verticalBarChart = new Chart(
                document.getElementById('verticalBarChart'),
                configVerticalBarChart
            );
        });
    </script>
{% endblock scripts %}
