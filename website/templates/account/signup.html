{% extends "account/base_account.html" %}
{% load static %}
{% load custom_tags %}
{% load captcha %}
{% block account_title %}Sign Up | {% env 'PROJECT_NAME' %}{% endblock account_title %}
{% block account_description %}Create an account to join the community. Sign up with your email and username to start discovering and reporting bugs.{% endblock account_description %}
{% block account_keywords %}Sign Up, Create Account, Join Community, Email, Username, Discover Bugs, Report Bugs{% endblock account_keywords %}
{% block account_og_title %}Sign Up - Join Our Community{% endblock account_og_title %}
{% block account_og_description %}Create an account to join our community. Sign up with your email and username to start discovering and reporting bugs.{% endblock account_og_description %}
{% load i18n %}
{% block account_content %}
    <div class="flex items-center justify-center w-full min-h-screen p-4 bg-gray-100 h-full">
        <div class="flex flex-col w-full max-w-md bg-white rounded-md shadow-lg md:flex-row md:max-w-2xl lg:max-w-4xl">
            <!-- Left Section -->
            <div class="p-4 py-6 text-white bg-red-500 md:w-96 md:flex-shrink-0 md:flex md:flex-col md:items-center md:justify-evenly">
                <div class="my-3 text-4xl font-bold tracking-wider text-center">
                    <a href="{% url 'home' %}"
                       class="hover:no-underline text-white hover:text-white">{% env 'PROJECT_NAME' %}</a>
                </div>
                <p class="mt-6 font-normal text-center text-white text-xl md:mt-0">
                    {% env 'PROJECT_NAME' %} {% trans "is a bug logging tool to report issues and get points, Organizations are held accountable" %}.
                </p>
                <p class="flex flex-col items-center justify-center text-sm mt-10 text-center">
                    <span>{% trans "Already have an account" %}?</span>
                    <a href="{% url 'account_login' %}?next={{ request.path }}"
                       class="underline text-white">{% trans "Login" %}!</a>
                </p>
                <p class="mt-6 text-sm text-center text-white">
                    {% trans "Read our" %} <a href="{% url 'terms' %}" class="underline">{% trans "terms" %}</a> {% trans "and" %} <a href="{% url 'terms' %}" class="underline">{% trans "conditions" %}</a>
                </p>
            </div>
            <!-- Right Section -->
            <div class="p-5 bg-white md:flex-1">
                <h3 class="my-4 text-2xl font-semibold text-gray-700">{% trans "Sign up" %}</h3>
                <form class="flex flex-col space-y-5 login"
                      method="post"
                      action="{% url 'account_signup' %}">
                    {% csrf_token %}
                    <!-- Username Field -->
                    <div class="flex flex-col space-y-1">
               <label for="id_username" class="text-sm font-semibold text-gray-500">{% trans "Username" %}</label>
               <input autofocus
                   autocomplete="username"
                   required
                   aria-describedby="username-errors"
                   type="text"
                   id="id_username"
                   name="username"
                   value="{{ form.username.value|default:'' }}"
                   class="px-4 py-2 w-full transition duration-300 border border-gray-300 rounded focus:border-transparent focus:outline-none focus:ring-4 focus:ring-red-200" />
               <span id="username-errors" class="help-block">{{ form.username.errors }}</span>
                    </div>
                    <!-- Email Field -->
                    <div class="flex flex-col space-y-1">
               <label for="id_email" class="text-sm font-semibold text-gray-500">{% trans "Email" %}</label>
               <input type="email"
                   inputmode="email"
                   autocomplete="email"
                   required
                   aria-describedby="email-errors"
                   id="id_email"
                   name="email"
                   value="{{ form.email.value|default:'' }}"
                   class="px-4 py-2 w-full transition duration-300 border border-gray-300 rounded focus:border-transparent focus:outline-none focus:ring-4 focus:ring-red-200" />
               <span id="email-errors" class="help-block">{{ form.email.errors }}</span>
                    </div>
                    <!-- Password Field -->
                    <div class="flex flex-col space-y-1">
                        <div class="flex items-center justify-between">
                            <label for="id_password" class="text-sm font-semibold text-gray-500">{% trans "Password" %}</label>
                        </div>
                        <div class="relative">
                <input type="password"
                    id="id_password"
                    name="password1"
                    autocomplete="new-password"
                    required
                    aria-describedby="password1-errors"
                    value="{{ form.password1.value|default:'' }}"
                    class="px-4 py-2 w-full transition duration-300 border border-gray-300 rounded focus:border-transparent focus:outline-none focus:ring-4 focus:ring-red-200" />
                <button type="button"
                                    class="password-toggle absolute inset-y-0 right-2 flex items-center text-gray-500 hover:text-gray-800 focus:outline-none"
                                    data-target="id_password">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     viewBox="0 0 24 24"
                                     fill="currentColor"
                                     class="size-6">
                                    <path d="M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM22.676 12.553a11.249 11.249 0 0 1-2.631 4.31l-3.099-3.099a5.25 5.25 0 0 0-6.71-6.71L7.759 4.577a11.217 11.217 0 0 1 4.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113Z" />
                                    <path d="M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0 1 15.75 12ZM12.53 15.713l-4.243-4.244a3.75 3.75 0 0 0 4.244 4.243Z" />
                                    <path d="M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 0 0-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 0 1 6.75 12Z" />
                                </svg>
                            </button>
                        </div>
                        <span id="password1-errors" class="help-block">{{ form.password1.errors }}</span>
                    </div>
                    <!-- Confirm Password Field -->
                    <div class="flex flex-col space-y-1">
                        <div class="flex items-center justify-between">
                            <label for="id_password2" class="text-sm font-semibold text-gray-500">{% trans "Confirm password" %}</label>
                        </div>
                        <div class="relative">
                <input type="password"
                    id="id_password2"
                    name="password2"
                    autocomplete="new-password"
                    required
                    aria-describedby="password2-errors"
                    value="{{ form.password2.value|default:'' }}"
                    class="px-4 py-2 w-full transition duration-300 border border-gray-300 rounded focus:border-transparent focus:outline-none focus:ring-4 focus:ring-red-200" />
                <button type="button"
                                    class="password-toggle absolute inset-y-0 right-2 flex items-center text-gray-500 hover:text-gray-800 focus:outline-none"
                                    data-target="id_password2">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     viewBox="0 0 24 24"
                                     fill="currentColor"
                                     class="size-6">
                                    <path d="M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM22.676 12.553a11.249 11.249 0 0 1-2.631 4.31l-3.099-3.099a5.25 5.25 0 0 0-6.71-6.71L7.759 4.577a11.217 11.217 0 0 1 4.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113Z" />
                                    <path d="M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0 1 15.75 12ZM12.53 15.713l-4.243-4.244a3.75 3.75 0 0 0 4.244 4.243Z" />
                                    <path d="M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 0 0-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 0 1 6.75 12Z" />
                                </svg>
                            </button>
                        </div>
                        <span id="password2-errors" class="help-block">{{ form.password2.errors }}</span>
                    </div>
                    <!-- Captcha Field -->
                    <div class="flex flex-col space-y-1">
                        <label for="id_captcha_1" class="text-sm font-semibold text-gray-500">{% trans "Captcha" %}</label>
                        {{ form.captcha }}
                        <span id="captcha-errors" class="help-block">{{ form.captcha.errors }}</span>
                    </div>
                    <!-- Hidden Redirect Field -->
                    {% if redirect_field_value %}
                        <input type="hidden"
                               name="{{ redirect_field_name }}"
                               value="{{ redirect_field_value }}" />
                    {% endif %}
                    <!-- Submit Button -->
                    <div>
                        <button type="submit"
                                name="signup_button"
                                class="w-full md:w-auto px-4 py-2 text-lg font-semibold text-white transition-colors duration-300 bg-red-500 rounded-md shadow hover:bg-red-600 focus:outline-none focus:ring-red-200 focus:ring-4">
                            {% trans "Sign Up" %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock account_content %}

{% block account_extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Captcha refresh
    const container = document.querySelector('.captcha-container');
    const hidden = () => container && container.querySelector('input[name="captcha_0"]');
    const img = () => container && container.querySelector('#captcha-image');

    async function refreshCaptcha() {
        try {
            const res = await fetch("{% url 'captcha-refresh' %}", { headers: { "X-Requested-With": "XMLHttpRequest" }});
            const data = await res.json();
            if (hidden()) hidden().value = data.key;
            if (img()) img().src = `${data.image_url}?${Date.now()}`;
        } catch (e) { console.error(e); }
    }

    refreshCaptcha();
    const btn = document.querySelector('button[onclick="refreshCaptcha()"]');
    if (btn) {
        btn.addEventListener('click', (ev) => { ev.preventDefault(); refreshCaptcha(); });
    }

    // Password toggle
    document.querySelectorAll('.password-toggle').forEach(btn => {
        btn.addEventListener('click', () => {
            const id = btn.getAttribute('data-target');
            const input = document.getElementById(id);
            if (!input) return;
            input.type = input.type === 'password' ? 'text' : 'password';
        });
    });
});
</script>
{% endblock account_extra_js %}
{% endblock account_content %}
