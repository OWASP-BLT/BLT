{% extends "base.html" %}
{% load static %}
{% block title %}Review Queue{% endblock %}
{% block content %}
    {% include "includes/sidenav.html" %}
    <div class="p-6 lg:p-8 bg-gray-50 dark:bg-gray-900 min-h-screen">
        <div class="max-w-7xl mx-auto">
            <div class="mb-8">
                <h1 class="text-4xl font-extrabold text-gray-900 dark:text-gray-100 mb-2">Review Queue</h1>
                <p class="text-lg text-gray-600 dark:text-gray-400">Review and moderate pending issues.</p>
            </div>
            {% if messages %}
                <div class="mb-6">
                    {% for message in messages %}
                        <div class="message-alert mb-3 p-4 rounded-lg flex items-center justify-between shadow-lg animate-slide-in {% if message.tags == 'success' %}bg-green-100 text-green-700 border-l-4 border-green-500{% elif message.tags == 'error' %}bg-red-100 text-red-700 border-l-4 border-red-500{% elif message.tags == 'warning' %}bg-yellow-100 text-yellow-700 border-l-4 border-yellow-500{% else %}bg-blue-100 text-blue-700 border-l-4 border-blue-500{% endif %}">
                            <div class="flex-grow mr-3">{{ message }}</div>
                            <button class="text-gray-500 dark:text-gray-500 hover:text-gray-700 focus:outline-none close-message"
                                    onclick="this.parentElement.style.display='none';">Ã—</button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm">
                <div class="border-b border-gray-200 dark:border-gray-700">
                    <ul class="flex flex-wrap -mb-px" id="myTab" role="tablist">
                        <li class="mr-2" role="presentation">
                            <button class="inline-block py-4 px-4 text-sm font-medium text-center text-gray-500 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 active"
                                    id="all-tab"
                                    data-tabs-target="#all"
                                    type="button"
                                    role="tab"
                                    aria-controls="all"
                                    aria-selected="true">All Pending ({{ pending_issues.count }})</button>
                        </li>
                        <li class="mr-2" role="presentation">
                            <button class="inline-block py-4 px-4 text-sm font-medium text-center text-gray-500 rounded-t-lg border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"
                                    id="spam-tab"
                                    data-tabs-target="#spam"
                                    type="button"
                                    role="tab"
                                    aria-controls="spam"
                                    aria-selected="false">Spam ({{ spam_issues.count }})</button>
                        </li>
                    </ul>
                </div>
                <div id="myTabContent">
                    <div class="p-4 bg-white dark:bg-gray-800 rounded-lg md:p-8"
                         id="all"
                         role="tabpanel"
                         aria-labelledby="all-tab">
                        {% include 'review/_issue_list.html' with issues=pending_issues tab_id='pending' %}
                    </div>
                    <div class="hidden p-4 bg-white dark:bg-gray-800 rounded-lg md:p-8"
                         id="spam"
                         role="tabpanel"
                         aria-labelledby="spam-tab">
                        {% include 'review/_issue_list.html' with issues=spam_issues tab_id='spam' %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabs = document.querySelectorAll('[data-tabs-target]');
        const tabContents = document.querySelectorAll('[role="tabpanel"]');

        tabs.forEach(tab => {
            tab.addEventListener('click', function () {
                const target = document.querySelector(tab.dataset.tabsTarget);

                tabContents.forEach(tc => {
                    tc.classList.add('hidden');
                });
                target.classList.remove('hidden');

                tabs.forEach(t => {
                    t.classList.remove('border-blue-600', 'text-blue-600');
                    t.classList.add('border-transparent', 'text-gray-500');
                    t.setAttribute('aria-selected', 'false');
                });

                tab.classList.add('border-blue-600', 'text-blue-600');
                tab.classList.remove('border-transparent', 'text-gray-500');
                tab.setAttribute('aria-selected', 'true');
            });
        });

        // Set the first tab as active on page load
        if (tabs.length > 0) {
            tabs[0].click();
        }
    });
    </script>
{% endblock %}
