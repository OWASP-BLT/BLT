{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% block title %}
    Project List
{% endblock title %}
{% block content %}
    <style>
    /* Project Card Specific Styles */
    .project-title h3 {
        font-size: 1.4rem;
        font-weight: 700;
        color: #ef4444; /* Using theme color directly instead of gradient */
        margin: 0 0 0.6rem 0;
        /* Removed the gradient and webkit properties */
    }

    .project-title {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .project-badges {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
    }

    /* Update badge styles for better consistency */
    .badge {
        padding: 0.35rem 1rem;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.4rem;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
    }

    .badge:hover {
        transform: translateY(-1px);
        box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.1);
    }

    .badge i {
        font-size: 0.9rem;
    }
    /* Modern Variables */
    :root {
        --primary-color: #3182ce;
        --secondary-color: #4a5568;
        --success-color: #48bb78;
        --danger-color: #f56565;
        --warning-color: #ed8936;
        --info-color: #4299e1;
        --background-color: #f7fafc;
        --card-background: #ffffff;
        --border-color: #e2e8f0;
        --text-primary: #2d3748;
        --text-secondary: #718096;
    }

    /* Repo Card Styles */
    .repo-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: transform 0.2s;
    }

    .repo-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .repo-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }

    .repo-logo {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        margin-right: 1rem;
    }

    .repo-title {
        flex: 1;
    }

    .repo-title h3 {
        margin: 0;
        font-size: 1.1rem;
        color: #2d3748;
    }

    .badge-language {
        background: #e2e8f0;
        color: #4a5568;
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        margin-left: 0.5rem;
    }

    .repo-description {
        color: #4a5568;
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }

    .repo-stats {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }

    .repo-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #e2e8f0;
    }

    .repo-parent {
        font-size: 0.9rem;
        color: #718096;
    }

    .repo-parent a {
        color: #4a5568;
        text-decoration: none;
        font-weight: 500;
    }

    .repo-parent a:hover {
        text-decoration: underline;
    }

    /* Modal Animations */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 1050;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }

    .modal.show {
        opacity: 1;
    }

    .modal-dialog {
        position: relative;
        width: auto;
        margin: 1.75rem auto;
        max-width: 500px;
        transform: translateY(-50px);
        transition: transform 0.3s ease-out;
    }

    .modal.show .modal-dialog {
        transform: translateY(0);
    }

    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 1040;
    }

    /* Filter Modal Specific Styles */
    .filter-section {
        margin-bottom: 1.5rem;
    }

    .filter-section h6 {
        margin-bottom: 0.75rem;
        color: var(--text-primary);
        font-weight: 600;
    }

    .form-select {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: 0.375rem;
        margin-bottom: 0.5rem;
        background-color: white;
    }

    .form-select:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 2px rgba(49, 130, 206, 0.2);
    }

    /* Alert Styling */
    .alert {
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 6px;
        animation: slideIn 0.3s ease-out;
    }

    .alert-danger {
        background-color: var(--danger-color);
        color: white;
    }

    @keyframes slideIn {
        from {
            transform: translateY(-100%);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .modal-dialog {
            margin: 1rem;
        }

        .repo-stats {
            flex-wrap: wrap;
        }

        .repo-footer {
            flex-direction: column;
            gap: 1rem;
        }

        .repo-parent {
            text-align: center;
        }
    }
    .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1050;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

.modal.show {
    opacity: 1;
    visibility: visible;
}

.modal-dialog {
    position: relative;
    width: 90%;
    max-width: 500px;
    margin: 2rem auto;
    transform: translateY(-20px) scale(0.95);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.modal.show .modal-dialog {
    transform: translateY(0) scale(1);
    opacity: 1;
}

.modal-content {
    background: linear-gradient(145deg, #ffffff, #f8fafc);
    border-radius: 20px;
    box-shadow: 
        0 25px 50px -12px rgba(0, 0, 0, 0.25),
        0 0 0 1px rgba(239, 68, 68, 0.1);
    overflow: hidden;
}

.modal-header {
    background: linear-gradient(145deg, #ef4444, #dc2626);
    padding: 1.25rem 1.5rem;
    color: white;
    border: none;
    position: relative;
    overflow: hidden;
}

.modal-header::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        45deg,
        rgba(255, 255, 255, 0.1) 0%,
        rgba(255, 255, 255, 0) 100%
    );
    pointer-events: none;
}

.modal-header h5 {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.modal-body {
    padding: 1.5rem;
}

.filter-section {
    background: #f8fafc;
    padding: 1.25rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    border: 1px solid #e2e8f0;
}

.filter-section h6 {
    color: #1e293b;
    font-weight: 600;
    margin-bottom: 1rem;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-section h6::before {
    content: '';
    width: 4px;
    height: 1em;
    background: #ef4444;
    border-radius: 2px;
}

.form-select {
    background: white;
    border: 2px solid #f1f5f9;
    border-radius: 10px;
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
    transition: all 0.2s;
    width: 100%;
    margin-bottom: 0.75rem;
}

.form-select:focus {
    border-color: #ef4444;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    outline: none;
}

/* Responsive adjustments */
@media (max-width: 1200px) {
    .container {
        max-width: 960px !important;
    }
}

@media (max-width: 1024px) {
    .project-grid {
        grid-template-columns: 1fr;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .project-card, .repo-card {
        max-width: 100%;
    }
}

@media (max-width: 640px) {
    .container {
        padding: 0 1rem;
    }
    
    .modal-dialog {
        width: 95%;
        margin: 1rem auto;
    }
    
    .modal-body {
        padding: 1.25rem;
    }
}

/* Container and Grid Layout */
.container {
    max-width: 1200px !important;
    margin: 0 auto;
    padding: 0 4rem; /* Increased padding */
    margin-top: 5rem;
}

.project-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 2rem;
    margin: 2rem auto;
    padding: 0 2rem;
    max-width: 1100px; /* Limit grid width */
}

/* Card width control */
.project-card, .repo-card {
    max-width: 450px; /* Reduced max-width */
    margin: 0 auto;
    width: 100%;
    background: linear-gradient(145deg, #ffffff, #fafafa);
    border-radius: 20px;
    box-shadow: 
        8px 8px 30px rgba(239, 68, 68, 0.1),
        -8px -8px 30px rgba(255, 255, 255, 0.8);
    padding: 1.8rem;
    position: relative;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 1px solid rgba(239, 68, 68, 0.1);
}

.project-card:hover, .repo-card:hover {
    transform: translateY(-8px) scale(1.01);
    box-shadow: 
        12px 12px 40px rgba(239, 68, 68, 0.15),
        -12px -12px 40px rgba(255, 255, 255, 0.9);
}


.badge-active { 
    background: linear-gradient(145deg, #fecaca, #ef4444);
    color: white;
}

.badge-inactive { 
    background: linear-gradient(145deg, #fee2e2, #fecaca);
    color: #ef4444;
}

.badge-level { 
    background: linear-gradient(145deg, #fecaca, #ef4444);
    color: white;
}

.badge-language { 
    background: linear-gradient(145deg, #fee2e2, #fecaca);
    color: #ef4444;
}

/* Stats Section */
.project-stats, .repo-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin: 1.5rem 0;
    padding: 1rem;
    background: linear-gradient(145deg, #fafafa, #f5f5f5);
    border-radius: 16px;
    box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.05);
}

.stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.3rem;
    padding: 0.8rem;
    border-radius: 12px;
    background: linear-gradient(145deg, #ffffff, #fafafa);
    box-shadow: 
        3px 3px 8px rgba(239, 68, 68, 0.1),
        -3px -3px 8px rgba(255, 255, 255, 0.8);
}

.stat i {
    font-size: 1.2rem;
    color: #ef4444;
}

/* Buttons */
.btn {
    padding: 0.7rem 1.5rem;
    border-radius: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.btn-github {
    background: linear-gradient(145deg, #ef4444, #dc2626);
    color: white;
    border: none;
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2);
}

.btn-github:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
}

.btn-details {
    background: linear-gradient(145deg, #f3f4f6, #ffffff);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.2);
}

.btn-details:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
}

/* Responsive adjustments */
@media (max-width: 1400px) {
    .container {
        padding: 0 3rem;
    }
    .project-grid {
        padding: 0 1.5rem;
    }
}

@media (max-width: 1200px) {
    .project-grid {
        gap: 1.5rem;
    }
}

@media (max-width: 1024px) {
    .container {
        padding: 0 2rem;
    }
    .project-grid {
        grid-template-columns: 1fr;
        max-width: 600px;
        padding: 0;
    }
    .project-card, .repo-card {
        max-width: 100%;
    }
}

@media (max-width: 640px) {
    .container {
        padding: 0 1rem;
    }
    .project-stats, .repo-stats {
        grid-template-columns: repeat(2, 1fr);
    }
}

.pagination-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    margin-top: 2rem;
}

.pagination-info {
    color: #666;
    font-size: 0.9rem;
}

.pagination {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.page-item {
    display: inline-block;
}

.page-link {
    padding: 0.5rem 1rem;
    border-radius: 6px;
    background: white;
    color: #ef4444;
    text-decoration: none;
    transition: all 0.2s;
    border: 1px solid rgba(239, 68, 68, 0.2);
}

.page-item.active .page-link {
    background: #ef4444;
    color: white;
    border-color: #ef4444;
}

.page-link:hover {
    background: #fff5f5;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(239, 68, 68, 0.1);
}

.messages {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1060;
    min-width: 300px;
    max-width: 500px;
}

.alert {
    margin-bottom: 1rem;
    padding: 1rem 1.5rem;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    animation: slideIn 0.3s ease-out;
}

.alert-success {
    background: linear-gradient(145deg, #48bb78, #38a169);
    color: white;
    border: none;
}

.alert-danger {
    background: linear-gradient(145deg, #ef4444, #dc2626);
    color: white;
    border: none;
}

.alert-info {
    background: linear-gradient(145deg, #4299e1, #3182ce);
    color: white;
    border: none;
}

.alert .close {
    color: white;
    opacity: 0.8;
    text-shadow: none;
    transition: opacity 0.2s;
}

.alert .close:hover {
    opacity: 1;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Auto-hide messages after 5 seconds */
.alert {
    animation: slideIn 0.3s ease-out, fadeOut 0.3s ease-out 4.7s forwards;
}

@keyframes fadeOut {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
        transform: translateX(100%);
    }
}
    </style>
    <script>
// Add this to your JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Auto-remove alerts after 5 seconds
    document.querySelectorAll('.alert').forEach(alert => {
        setTimeout(() => {
            alert.remove();
        }, 5000);
    });

    // Handle form submissions
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const submitButton = form.querySelector('button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            }
        });
    });

    // Handle modal close on successful submission
    if (document.querySelector('.alert-success')) {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            const modalInstance = bootstrap.Modal.getInstance(modal);
            if (modalInstance) {
                modalInstance.hide();
            }
        });
    }
});
    </script>
    {% include "includes/sidenav.html" %}
    <div class="container pb-4">
        <!-- Header Section -->
        <div class="flex flex-col lg:flex-row gap-4 top-bar">
            <h3>Projects: {{ projects.count }}</h3>
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary"
                        data-toggle="modal"
                        data-target="#addProjectModal">
                    <i class="fas fa-plus-circle"></i> Add Project
                </button>
                <button class="btn btn-secondary"
                        data-toggle="modal"
                        data-target="#addRepoModal">
                    <i class="fas fa-plus-circle"></i> Add Additional Repo
                </button>
                <button class="btn btn-info" data-toggle="modal" data-target="#filterModal">
                    <i class="fas fa-filter"></i> Filter & Search
                </button>
            </div>
            <!-- Refresh Projects Form -->
            <form method="post" class="refresh-projects-form">
                {% csrf_token %}
                <button type="submit" name="refresh_stats" value="refresh_stats">
                    <i class="fas fa-sync-alt"></i> Refresh Projects
                </button>
            </form>
        </div>
        <!-- Messages Section -->
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="alert {% if message.tags == 'error' %}alert-danger{% elif message.tags == 'success' %}alert-success{% elif message.tags == 'info' %}alert-info{% endif %} alert-dismissible fade show"
                         role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">x</span>
                        </button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        <!-- Filter Modal -->
        <div class="modal fade" id="filterModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5>Filter Projects & Repositories</h5>
                        <button type="button" class="close" data-dismiss="modal">x</button>
                    </div>
                    <div class="modal-body">
                        <form method="get" id="filterForm">
                            <!-- Search -->
                            <div class="form-group">
                                <input type="search"
                                       name="search"
                                       value="{{ search_query }}"
                                       class="form-control"
                                       placeholder="Search projects and repos...">
                            </div>
                            <!-- Filter Type Selection -->
                            <div class="filter-type-selection mb-3">
                                <h6>What to filter?</h6>
                                <select name="filter_type" class="form-select" id="filterTypeSelect">
                                    <option value="all" {% if filter_type == 'all' %}selected{% endif %}>Both Projects & Additional Repos</option>
                                    <option value="projects"
                                            {% if filter_type == 'projects' %}selected{% endif %}>
                                        Projects Only
                                    </option>
                                    <option value="repos" {% if filter_type == 'repos' %}selected{% endif %}>Additional Repos Only</option>
                                </select>
                            </div>
                            <!-- Project Filters -->
                            <div class="filter-section project-filters">
                                <h6>Project Filters</h6>
                                <select name="activity_status" class="form-select">
                                    <option value="">Activity Status</option>
                                    {% for status in activity_statuses %}
                                        <option value="{{ status }}"
                                                {% if selected_status == status %}selected{% endif %}>
                                            {{ status }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <select name="project_type" class="form-select mt-2">
                                    <option value="">Project Type</option>
                                    {% for type in project_types %}
                                        <option value="{{ type }}" {% if selected_type == type %}selected{% endif %}>{{ type }}</option>
                                    {% endfor %}
                                </select>
                                <select name="project_lavel" class="form-select mt-2">
                                    <option value="">Project Level</option>
                                    {% for level in project_levels %}
                                        <option value="{{ level }}"
                                                {% if selected_level == level %}selected{% endif %}>
                                            {{ level }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <!-- Additional Repo Filters -->
                            <div class="filter-section repo-filters mt-3">
                                <h6>Repository Filters</h6>
                                <select name="repo_language" class="form-select">
                                    <option value="">Primary Language</option>
                                    {% for lang in repo_languages %}
                                        <option value="{{ lang }}"
                                                {% if selected_language == lang %}selected{% endif %}>
                                            {{ lang }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <!-- Sort Options -->
                            <div class="filter-section mt-3">
                                <h6>Sort Options</h6>
                                <select name="sort_by" class="form-select">
                                    <option value="-created" {% if sort_by == '-created' %}selected{% endif %}>Recently Added</option>
                                    <option value="stars" {% if sort_by == 'stars' %}selected{% endif %}>Stars</option>
                                    <option value="forks" {% if sort_by == 'forks' %}selected{% endif %}>Forks</option>
                                    <option value="total_issues"
                                            {% if sort_by == 'total_issues' %}selected{% endif %}>Issues</option>
                                    <option value="contributor_count"
                                            {% if sort_by == 'contributor_count' %}selected{% endif %}>
                                        Contributors
                                    </option>
                                </select>
                                <select name="order" class="form-select mt-2">
                                    <option value="desc" {% if order == 'desc' %}selected{% endif %}>Descending</option>
                                    <option value="asc" {% if order == 'asc' %}selected{% endif %}>Ascending</option>
                                </select>
                            </div>
                            <div class="modal-footer">
                                <button type="reset" class="btn btn-secondary">Reset Filters</button>
                                <button type="submit" class="btn btn-primary">Apply Filters</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- Project/Repo Grid -->
        <div class="project-grid">
            {% if filter_type == 'repos' %}
                {% for repo in page_obj %}
                    {% include "includes/repo_card.html" with repo=repo %}
                {% endfor %}
            {% else %}
                {% for project in page_obj %}
                    {% include "includes/project_card.html" with project=project %}
                    {% if filter_type == 'all' and project.additional_repos.exists %}
                        {% for repo in project.additional_repos.all %}
                            {% include "includes/repo_card.html" with repo=repo %}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
        <!-- Pagination -->
        {% if is_paginated %}
            <nav aria-label="Project pagination" class="pagination-container">
                <div class="pagination-info">
                    Page {{ page_obj.number }} of {{ paginator.num_pages }}
                    ({{ paginator.count }} total items)
                </div>
                <ul class="pagination">
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link"
                               href="?{% for key,value in current_params.items %}{{ key }}={{ value }}&{% endfor %}page=1">« First</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link"
                               href="?{% for key,value in current_params.items %}{{ key }}={{ value }}&{% endfor %}page={{ page_obj.previous_page_number }}">Previous</a>
                        </li>
                    {% endif %}
                    {% for num in paginator.page_range %}
                        {% if num == page_obj.number %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link"
                                   href="?{% for key,value in current_params.items %}{{ key }}={{ value }}&{% endfor %}page={{ num }}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link"
                               href="?{% for key,value in current_params.items %}{{ key }}={{ value }}&{% endfor %}page={{ page_obj.next_page_number }}">Next</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link"
                               href="?{% for key,value in current_params.items %}{{ key }}={{ value }}&{% endfor %}page={{ paginator.num_pages }}">Last »</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
    </div>
    {% include "includes/add_project_modal.html" %}
    {% include "includes/add_repo_modal.html" %}
    {% block extra_js %}
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() {
            // Modal handling
            const modals = {
                addProject: document.getElementById('addProjectModal'),
                addRepo: document.getElementById('addRepoModal'),
                filter: document.getElementById('filterModal')
            };

            // Show modal function
            function showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'block';
                    // Use requestAnimationFrame to ensure display takes effect
                    requestAnimationFrame(() => {
                        modal.classList.add('show');
                    });
                    document.body.style.overflow = 'hidden';
                }
            }

            // Hide modal function
            function hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('show');
                    // Wait for animation to complete
                    setTimeout(() => {
                        modal.style.display = 'none';
                        document.body.style.overflow = '';
                    }, 300);
                }
            }

            // Close modal when clicking outside
            window.onclick = function(event) {
                for (let modalId in modals) {
                    const modal = modals[modalId];
                    if (event.target === modal) {
                        hideModal(modal.id);
                    }
                }
            }

            // Add click handlers for modal triggers
            document.querySelectorAll('[data-toggle="modal"]').forEach(button => {
                button.addEventListener('click', function() {
                    const targetModal = this.getAttribute('data-target').replace('#', '');
                    showModal(targetModal);
                });
            });

            // Add click handlers for modal close buttons
            document.querySelectorAll('.modal .close').forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    hideModal(modal.id);
                });
            });

            // Form submissions
            const addProjectForm = document.querySelector('#addProjectModal form');
            if (addProjectForm) {
                addProjectForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    try {
                        const response = await fetch(window.location.href, {
                            method: 'POST',
                            body: new FormData(this),
                            headers: {
                                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                            }
                        });

                        if (response.ok) {
                            // Refresh the page to show the new project
                            window.location.reload();
                        } else {
                            const data = await response.json();
                            showError(data.error || 'Failed to add project');
                        }
                    } catch (error) {
                        showError('An error occurred while adding the project');
                    }
                });
            }

            const addRepoForm = document.querySelector('#addRepoModal form');
            if (addRepoForm) {
                addRepoForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    try {
                        const response = await fetch(window.location.href, {
                            method: 'POST',
                            body: new FormData(this),
                            headers: {
                                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                            }
                        });

                        if (response.ok) {
                            window.location.reload();
                        } else {
                            const data = await response.json();
                            showError(data.error || 'Failed to add repository');
                        }
                    } catch (error) {
                        showError('An error occurred while adding the repository');
                    }
                });
            }

            // Filter form handling
            const filterForm = document.getElementById('filterForm');
            if (filterForm) {
                filterForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    const searchParams = new URLSearchParams();

                    for (let [key, value] of formData.entries()) {
                        if (value) {  // Only add non-empty values
                            searchParams.append(key, value);
                        }
                    }

                    // Preserve existing page number if any
                    const currentPage = new URLSearchParams(window.location.search).get('page');
                    if (currentPage) {
                        searchParams.append('page', currentPage);
                    }

                    window.location.href = `${window.location.pathname}?${searchParams.toString()}`;
                });

                // Handle reset button
                const resetButton = filterForm.querySelector('button[type="reset"]');
                if (resetButton) {
                    resetButton.addEventListener('click', function(e) {
                        e.preventDefault();
                        window.location.href = window.location.pathname;
                    });
                }
            }

            // Error message display
            function showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'alert alert-danger';
                errorDiv.textContent = message;
                
                const container = document.querySelector('.container');
                container.insertBefore(errorDiv, container.firstChild);
                
                setTimeout(() => {
                    errorDiv.remove();
                }, 5000);
            }

            // Add some basic animations
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('show.bs.modal', function() {
                    this.style.opacity = 0;
                    setTimeout(() => {
                        this.style.opacity = 1;
                    }, 10);
                });
            });

            // Handle filter type selection
            const filterTypeSelect = document.getElementById('filterTypeSelect');
            const projectFilters = document.querySelector('.project-filters');
            const repoFilters = document.querySelector('.repo-filters');

            if (filterTypeSelect) {
                filterTypeSelect.addEventListener('change', function() {
                    const selectedValue = this.value;
                    
                    if (selectedValue === 'projects') {
                        projectFilters.style.display = 'block';
                        repoFilters.style.display = 'none';
                    } else if (selectedValue === 'repos') {
                        projectFilters.style.display = 'none';
                        repoFilters.style.display = 'block';
                    } else {
                        projectFilters.style.display = 'block';
                        repoFilters.style.display = 'block';
                    }
                });

                // Trigger change event on load to set initial state
                filterTypeSelect.dispatchEvent(new Event('change'));
            }

            // Add smooth scrolling for pagination
            document.querySelectorAll('.pagination a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const href = this.getAttribute('href');
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                    // Navigate after scroll animation
                    setTimeout(() => {
                        window.location.href = href;
                    }, 500);
                });
            });
        }); 
        </script>
    {% endblock %}
{% endblock %}
