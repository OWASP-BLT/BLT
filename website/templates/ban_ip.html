{% extends "base.html" %}
{% block content %}
    <style>
    /* Container styling */
    .full-width-container {
        width: 100%;
        padding: 0;
        margin: 0;
        box-sizing: border-box;
    }

    /* Table styling */
    .full-width-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        font-size: 16px;
        border: 2px solid #333;
    }

    .full-width-table th, .full-width-table td {
        padding: 12px 20px;
        border: 1px solid #ddd;
        text-align: left;
    }

    .full-width-table th {
        background-color: #f4f4f4;
        font-weight: bold;
        font-size: 18px;
    }

    .full-width-table td {
        font-size: 16px;
    }

    .full-width-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    .full-width-table tr:hover {
        background-color: #e1e1e1;
    }

    .full-width-table caption {
        font-size: 24px;
        font-weight: bold;
        margin: 10px 0;
    }

    /* Ban IP form styling */
    .ban-ip-form {
        margin-bottom: 20px;
    }

    .ban-ip-form label {
        margin-right: 10px;
        font-size: 16px;
    }

    .ban-ip-form input[type="text"] {
        padding: 8px;
        font-size: 16px;
        margin-right: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .ban-ip-button {
        padding: 10px 15px;
        font-size: 16px;
        background-color: #ff4d4d;
        border: none;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        text-transform: uppercase;
        font-weight: bold;
    }

    .ban-ip-button:hover {
        background-color: #e60000;
    }

    /* Button inside the table */
    .ban-button {
        background-color: #ff4d4d;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        text-transform: uppercase;
    }

    .ban-button:hover {
        background-color: #e60000;
    }
    </style>
    <div class="full-width-container">
        <h1>MonitorIP List</h1>
        <!-- Table displaying IP monitoring records -->
        <table class="full-width-table">
            <caption>IP Monitoring Records</caption>
            <thead>
                <tr>
                    <th>IP Address</th>
                    <th>User Agent</th>
                    <th>Count</th>
                    <th>Ban</th>
                </tr>
            </thead>
            <tbody>
                {% for ip in ips %}
                    <tr>
                        <td>{{ ip.ip }}</td>
                        <td>{{ ip.user_agent }}</td>
                        <td>{{ ip.count }}</td>
                        <td>
                            <button class="ban-button" onclick="BanIp('{{ ip.ip }}')">Ban Ip</button>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4">No IP records found.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script>
    function BanIp(ip) {
        const csrftoken = getCookie('csrftoken');
        fetch(`/ban-ip/`, {
            method: "POST",
            headers: {
                'Content-Type': "application/json",
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({ ip: ip })
        })
        .then(response => {
            if (response.ok) {
                alert('IP address banned successfully.');
                location.reload();
            } else {
                alert('Failed to ban IP address.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while banning the IP address.');
        });
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    </script>
{% endblock content %}
